import{_ as $,c as i,b as d,d as t,F as C,k as x,j as u,t as h,e as v,v as y,g as V,r as _,o as r,s as S,h as b,n as f}from"./index-dcf0a1b7.js";const M={data(){return{products:[],product:{},status:{loadingItem:""},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1,coupon_code:""}},methods:{getProducts(){const a="https://vue3-course-api.hexschool.io/v2//api/seanhong/products";this.isLoading=!0,this.$http.get(a).then(e=>{this.products=e.data.products,this.isLoading=!1}).catch(e=>{this.isLoading=!1,this.$httpMessageState(e.response,"錯誤訊息")})},getProduct(a){this.$router.push(`/user/product/${a}`)},addToCart(a,e=1){this.isLoading=!0;const l="https://vue3-course-api.hexschool.io/v2//api/seanhong/cart";this.status.loadingItem=a;const p={product_id:a,qty:e};this.$http.post(l,{data:p}).then(o=>{this.status.loadingItem="",this.isLoading=!1,this.$httpMessageState(o,"加入購物車"),this.getCart()}).catch(o=>{this.isLoading=!1,this.$httpMessageState(o.response,"錯誤訊息")})},deleteAllCarts(){this.isLoading=!0;const a="https://vue3-course-api.hexschool.io/v2//api/seanhong/carts";this.$http.delete(a).then(e=>{this.$httpMessageState(e,"清除購物車"),this.getCart(),this.isLoading=!1}).catch(e=>{this.isLoading=!1,this.$httpMessageState(e.response,"清除購物車")})},getCart(){const a="https://vue3-course-api.hexschool.io/v2//api/seanhong/cart";this.isLoading=!0,this.$http.get(a).then(e=>{this.cart=e.data.data,this.isLoading=!1}).catch(e=>{this.isLoading=!1,this.$httpMessageState(e.response,"錯誤訊息")})},removeCartItem(a){this.status.loadingItem=a;const e=`https://vue3-course-api.hexschool.io/v2//api/seanhong/cart/${a}`;this.isLoading=!0,this.$http.delete(e).then(l=>{this.$httpMessageState(l,"移除購物車品項"),this.status.loadingItem="",this.isLoading=!1,this.getCart()}).catch(l=>{this.isLoading=!1,this.$httpMessageState(l.response,"移除購物車品項")})},updateCart(a){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/v2//api/seanhong/cart/${a.id}`,l={product_id:a.product_id,qty:a.qty};this.$http.put(e,{data:l}).then(p=>{this.$httpMessageState(p,"更新購物車"),this.isLoading=!1,this.getCart()}).catch(p=>{this.isLoading=!1,this.$httpMessageState(p.response,"更新購物車")})},addCouponCode(){const a="https://vue3-course-api.hexschool.io/v2//api/seanhong/coupon",e={code:this.coupon_code};this.isLoading=!0,this.$http.post(a,{data:e}).then(l=>{this.$httpMessageState(l,"加入優惠券"),this.getCart(),this.isLoading=!1}).catch(l=>{this.isLoading=!1,this.$httpMessageState(l.response,"加入優惠券")})},createOrder(){this.isLoading=!0;const a="https://vue3-course-api.hexschool.io/v2//api/seanhong/order",e=this.form;this.$http.post(a,{data:e}).then(l=>{this.$httpMessageState(l,"建立訂單"),this.$router.push(`/user/checkout/${l.data.orderId}`),this.$refs.form.resetForm(),this.isLoading=!1}).catch(l=>{this.isLoading=!1,this.$httpMessageState(l.response,"建立訂單")})}},created(){this.getProducts(),this.getCart()}},I={class:"container"},U={class:"mt-4"},q={class:"table align-middle"},w=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th",null,"功能")])],-1),F={style:{width:"200px"}},B={href:"#",class:"text-dark"},E={key:0,class:"h5"},z={key:1,class:"h6"},N={key:2,class:"h5"},P={class:"btn-group btn-group-sm"},T=["disabled","onClick"],A={key:0,class:"spinner-border spinner-grow-sm"},j=["onClick","disabled"],D={key:0,class:"spinner-border spinner-grow-sm"},O={class:"text-end"},G={class:"table align-middle"},H=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),J=["disabled","onClick"],K=t("i",{class:"bi bi-x"},null,-1),Q=[K],R={key:0,class:"text-success"},W={class:"input-group input-group-sm"},X=["onUpdate:modelValue","onBlur"],Y={class:"input-group-text"},Z={class:"text-end"},tt={key:0,class:"text-success"},st=t("td",{colspan:"3",class:"text-end"},"總計",-1),et={class:"text-end"},ot={key:0},at=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),lt={class:"text-end text-success"},nt={class:"input-group mb-3 input-group-sm"},it={class:"input-group-append"},rt={class:"my-5 row justify-content-center"},dt={class:"mb-3"},ct=t("label",{for:"email",class:"form-label"},"Email",-1),ut={class:"mb-3"},ht=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),pt={class:"mb-3"},gt=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),mt={class:"mb-3"},_t=t("label",{for:"address",class:"form-label"},"收件人地址",-1),bt={class:"mb-3"},ft=t("label",{for:"message",class:"form-label"},"留言",-1),vt=t("div",{class:"text-end"},[t("button",{class:"btn btn-danger"},"送出訂單")],-1);function yt(a,e,l,p,o,c){const k=_("Loading"),g=_("Field"),m=_("ErrorMessage"),L=_("Form");return r(),i("div",I,[d(k,{active:o.isLoading,"z-index":1060},null,8,["active"]),t("div",U,[t("table",q,[w,t("tbody",null,[(r(!0),i(C,null,x(o.products,s=>(r(),i("tr",{key:s.id},[t("td",F,[t("div",{style:S([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${s.imageUrl})`}])},null,4)]),t("td",null,[t("a",B,h(s.title),1)]),t("td",null,[s.price?u("",!0):(r(),i("div",E,h(s.origin_price)+" 元 ",1)),s.price?(r(),i("del",z,"原價 "+h(s.origin_price)+" 元",1)):u("",!0),s.price?(r(),i("div",N," 現在只要 "+h(s.price)+" 元 ",1)):u("",!0)]),t("td",null,[t("div",P,[t("button",{type:"button",class:"btn btn-outline-secondary",disabled:o.status.loadingItem===s.id||!s.is_enabled,onClick:n=>c.getProduct(s.id)},[o.status.loadingItem===s.id?(r(),i("span",A)):u("",!0),b(" 查看更多 ")],8,T),t("button",{type:"button",class:"btn btn-outline-danger",onClick:n=>c.addToCart(s.id),disabled:o.status.loadingItem===s.id||!s.is_enabled},[o.status.loadingItem===s.id?(r(),i("span",D)):u("",!0),b(" 加到購物車 ")],8,j)])])]))),128))])]),t("div",O,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=(...s)=>c.deleteAllCarts&&c.deleteAllCarts(...s))}," 清空購物車 ")]),t("table",G,[H,t("tbody",null,[o.cart.carts?(r(!0),i(C,{key:0},x(o.cart.carts,s=>(r(),i("tr",{key:s.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:o.status.loadingItem===s.id,onClick:n=>c.removeCartItem(s.id)},Q,8,J)]),t("td",null,[b(h(s.product.title)+" ",1),s.coupon?(r(),i("div",R,"已套用優惠券")):u("",!0)]),t("td",null,[t("div",W,[v(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":n=>s.qty=n,onBlur:n=>c.updateCart(s)},null,40,X),[[y,s.qty,void 0,{number:!0}]]),t("div",Y,"/ "+h(s.product.unit),1)])]),t("td",Z,[o.cart.final_total!==o.cart.total?(r(),i("small",tt,"折扣價：")):u("",!0),b(" "+h(a.$filters.currency(s.final_total)),1)])]))),128)):u("",!0)]),t("tfoot",null,[t("tr",null,[st,t("td",et,h(a.$filters.currency(o.cart.total)),1)]),o.cart.final_total!==o.cart.total?(r(),i("tr",ot,[at,t("td",lt,h(a.$filters.currency(o.cart.final_total)),1)])):u("",!0)])]),t("div",nt,[v(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=s=>o.coupon_code=s),placeholder:"請輸入優惠碼"},null,512),[[y,o.coupon_code]]),t("div",it,[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[2]||(e[2]=(...s)=>c.addCouponCode&&c.addCouponCode(...s))}," 套用優惠碼 ")])])]),t("div",rt,[d(L,{ref:"form",class:"col-md-6",onSubmit:c.createOrder},{default:V(({errors:s})=>[t("div",dt,[ct,d(g,{id:"email",name:"email",type:"email",class:f(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":e[3]||(e[3]=n=>o.form.user.email=n)},null,8,["class","modelValue"]),d(m,{name:"email",class:"invalid-feedback"})]),t("div",ut,[ht,d(g,{id:"name",name:"姓名",type:"text",class:f(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":e[4]||(e[4]=n=>o.form.user.name=n)},null,8,["class","modelValue"]),d(m,{name:"姓名",class:"invalid-feedback"})]),t("div",pt,[gt,d(g,{id:"tel",name:"電話",type:"tel",class:f(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:o.form.user.tel,"onUpdate:modelValue":e[5]||(e[5]=n=>o.form.user.tel=n)},null,8,["class","modelValue"]),d(m,{name:"電話",class:"invalid-feedback"})]),t("div",mt,[_t,d(g,{id:"address",name:"地址",type:"text",class:f(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":e[6]||(e[6]=n=>o.form.user.address=n)},null,8,["class","modelValue"]),d(m,{name:"地址",class:"invalid-feedback"})]),t("div",bt,[ft,v(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[7]||(e[7]=n=>o.form.message=n)},null,512),[[y,o.form.message]])]),vt]),_:1},8,["onSubmit"])])])}const xt=$(M,[["render",yt]]);export{xt as default};
