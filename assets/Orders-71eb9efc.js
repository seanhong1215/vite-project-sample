import{m as L,D as P}from"./modalMixin-37e4dfb1.js";import{_ as g,o,c as l,d as e,t as n,j as m,F as h,k as b,e as y,l as O,b as p,r as _,n as $}from"./index-dcf0a1b7.js";import{P as D,d as w,e as U}from"./api-eef7ceff.js";const V={props:{order:{type:Object,default(){return{}}}},data(){return{status:{},modal:"",tempOrder:{},isPaid:!1}},emits:["update-paid"],mixins:[L],inject:["emitter"],watch:{order(){this.tempOrder=this.order}}},E={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},N={class:"modal-dialog modal-xl",role:"document"},j={class:"modal-content border-0"},B=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),S={class:"modal-body"},q={class:"row"},z={class:"col-md-4"},F=e("h3",null,"用戶資料",-1),I={class:"table"},A={key:0},G=e("th",{style:{width:"100px"}},"姓名",-1),H=e("th",null,"Email",-1),J=e("th",null,"電話",-1),K=e("th",null,"地址",-1),Q={class:"col-md-8"},R=e("h3",null,"訂單細節",-1),T={class:"table"},W=e("th",{style:{width:"100px"}},"訂單編號",-1),X=e("th",null,"下單時間",-1),Y=e("th",null,"付款時間",-1),Z={key:0},ee={key:1},te=e("th",null,"付款狀態",-1),se={key:0,class:"text-success"},oe={key:1,class:"text-muted"},le=e("th",null,"總金額",-1),ne=e("h3",null,"選購商品",-1),de={class:"table"},re=e("thead",null,[e("tr")],-1),ie={class:"text-end"},ae={class:"d-flex justify-content-end"},ce={class:"form-check"},ue={class:"form-check-label",for:"flexCheckDefault"},he={key:0},pe={key:1},_e={class:"modal-footer"},me=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function be(s,r,i,f,t,u){return o(),l("div",E,[e("div",N,[e("div",j,[B,e("div",S,[e("div",q,[e("div",z,[F,e("table",I,[t.tempOrder.user?(o(),l("tbody",A,[e("tr",null,[G,e("td",null,n(t.tempOrder.user.name),1)]),e("tr",null,[H,e("td",null,n(t.tempOrder.user.email),1)]),e("tr",null,[J,e("td",null,n(t.tempOrder.user.tel),1)]),e("tr",null,[K,e("td",null,n(t.tempOrder.user.address),1)])])):m("",!0)])]),e("div",Q,[R,e("table",T,[e("tbody",null,[e("tr",null,[W,e("td",null,n(t.tempOrder.id),1)]),e("tr",null,[X,e("td",null,n(s.$filters.date(t.tempOrder.create_at)),1)]),e("tr",null,[Y,e("td",null,[t.tempOrder.paid_date?(o(),l("span",Z,n(s.$filters.date(t.tempOrder.paid_date)),1)):(o(),l("span",ee,"時間不正確"))])]),e("tr",null,[te,e("td",null,[t.tempOrder.is_paid?(o(),l("strong",se,"已付款")):(o(),l("span",oe,"尚未付款"))])]),e("tr",null,[le,e("td",null,n(s.$filters.currency(t.tempOrder.total)),1)])])]),ne,e("table",de,[re,e("tbody",null,[(o(!0),l(h,null,b(t.tempOrder.products,a=>(o(),l("tr",{key:a.id},[e("th",null,n(a.product.title),1),e("td",null,n(a.qty)+" / "+n(a.product.unit),1),e("td",ie,n(s.$filters.currency(a.final_total)),1)]))),128))])]),e("div",ae,[e("div",ce,[y(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":r[0]||(r[0]=a=>t.tempOrder.is_paid=a)},null,512),[[O,t.tempOrder.is_paid]]),e("label",ue,[t.tempOrder.is_paid?(o(),l("span",he,"已付款")):(o(),l("span",pe,"未付款"))])])])])])]),e("div",_e,[me,e("button",{type:"button",class:"btn btn-primary",onClick:r[1]||(r[1]=a=>s.$emit("update-paid",t.tempOrder))}," 修改付款狀態 ")])])])],512)}const fe=g(V,[["render",be]]),ge={data(){return{orders:{},isNew:!1,pagination:{},isLoading:!1,tempOrder:{},currentPage:1}},components:{Pagination:D,DelModal:P,OrderModal:fe},methods:{getOrders(s=1){this.currentPage=s;const r=`https://vue3-course-api.hexschool.io/v2//api/seanhong/admin/orders?page=${s}`;this.isLoading=!0,this.$http.get(r,this.tempProduct).then(i=>{this.orders=i.data.orders,this.pagination=i.data.pagination,this.isLoading=!1}).catch(i=>{this.isLoading=!1,console.log(i.response,"錯誤訊息")})},openModal(s){this.tempOrder={...s},this.isNew=!1,this.$refs.orderModal.openModal()},openDelOrderModal(s){this.tempOrder={...s},this.$refs.delModal.openModal()},updatePaid(s){this.isLoading=!0;const r={is_paid:s.is_paid};w(s.id,{data:r}).then(i=>{this.isLoading=!1,this.$refs.orderModal.hideModal(),this.getOrders(this.currentPage),console.log(i,"更新付款狀態")}).catch(i=>{this.isLoading=!1,console.log(i.response,"錯誤訊息")})},delOrder(){this.isLoading=!0,U(this.tempOrder.id).then(()=>{this.isLoading=!1,this.$refs.delModal.hideModal(),this.getOrders(this.currentPage)}).catch(s=>{this.isLoading=!1,console.log(s.response,"錯誤訊息")})}},created(){this.getOrders()}},ye={class:"table mt-4"},Oe=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),ke=["textContent"],ve={class:"list-unstyled"},Me={class:"text-right"},Ce={class:"form-check form-switch"},xe=["id","onUpdate:modelValue","onChange"],Le=["for"],Pe={key:0},$e={key:1},De={class:"btn-group"},we=["onClick"],Ue=["onClick"];function Ve(s,r,i,f,t,u){const a=_("Loading"),k=_("OrderModal"),v=_("DelModal"),M=_("Pagination");return o(),l(h,null,[p(a,{active:t.isLoading,"z-index":1060},null,8,["active"]),e("table",ye,[Oe,e("tbody",null,[(o(!0),l(h,null,b(t.orders,(d,C)=>(o(),l(h,{key:C},[t.orders.length?(o(),l("tr",{key:0,class:$({"text-secondary":!d.is_paid})},[e("td",null,n(s.$filters.date(d.create_at)),1),e("td",null,[d.user?(o(),l("span",{key:0,textContent:n(d.user.email)},null,8,ke)):m("",!0)]),e("td",null,[e("ul",ve,[(o(!0),l(h,null,b(d.products,(c,x)=>(o(),l("li",{key:x},n(c.product.title)+" 數量："+n(c.qty)+" "+n(c.product.unit),1))),128))])]),e("td",Me,n(d.total),1),e("td",null,[e("div",Ce,[y(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${d.id}`,"onUpdate:modelValue":c=>d.is_paid=c,onChange:c=>u.updatePaid(d)},null,40,xe),[[O,d.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${d.id}`},[d.is_paid?(o(),l("span",Pe,"已付款")):(o(),l("span",$e,"未付款"))],8,Le)])]),e("td",null,[e("div",De,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:c=>u.openModal(d)}," 檢視 ",8,we),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:c=>u.openDelOrderModal(d)}," 刪除 ",8,Ue)])])],2)):m("",!0)],64))),128))])]),p(k,{order:t.tempOrder,ref:"orderModal",onUpdatePaid:u.updatePaid},null,8,["order","onUpdatePaid"]),p(v,{item:t.tempOrder,ref:"delModal",onDelItem:u.delOrder},null,8,["item","onDelItem"]),p(M,{pages:t.pagination,onEmitPages:u.getOrders},null,8,["pages","onEmitPages"])],64)}const Be=g(ge,[["render",Ve]]);export{Be as default};
